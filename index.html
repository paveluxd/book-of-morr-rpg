<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div style="display: flex; gap: 24px;">
        <div style="display: flex; flex-direction: column;">
            <button onclick="loot(20)">Loot</button>
            <p id="items"></p>
        </div>
        <div style="display: flex; flex-direction: column;">
            <button onclick="genEnemyActions()">Enemy action</button>
            <input id='eneLvl' type="number" value="1">
            <p id="enemy">Test</p>
        </div>
    </div>
</body>

<script>
    //Utility functions
    function rng(maxVal, minVal){//random number
        if(minVal === undefined){minVal=1}
        return Math.floor(Math.random() * maxVal) + minVal
    }
    function rarr(arr){//random arr item
        return arr[Math.floor(Math.random() * arr.length)]
    }
    function shuffle(array) {//suffle arr
        let currentIndex = array.length,  randomIndex;

        // While there remain elements to shuffle.
        while (currentIndex != 0) {

            // Pick a remaining element.
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
            array[randomIndex], array[currentIndex]];
        }

        return array;
    }

    //Vars
    let lootList
    let refVal = 3
    let refRarity = 1

    let magicSchools = [
        'Sun',
        'Moon',
        'Life',
        'Chaos',
        'Death'
    ]
    let materials = [
        'stone',
        'wood',
        'iron',
        'coal'
    ]
    let plants = [
        `snake grass`,
        `rose`,
        `Fly agaric`,
        `Devil's bolete`,
        `Ivory funnel`,
    ]
    let eadables = [
        'orange mushroom',
        'sunflower seeds',
        'red berry']
    let misc = [
        'wood axe', 
        'hammer',
        'saw',
        `rope(${rng(15)}m)`,
        'grapling hook(${rng(15)}m)',
        'wooden bucket','iron chain',
        `${rng(8)}x iron nails`,
        `${rng(8)}x paper sheets`,
        `book`
    ]
    let itemsJson = {
        //Weapons
        "weapons":{
            "sword":{
                name: "sword", type: 'weapon', 
                desc: 'attacks with this weapon deal 1 more damage', 
            },
            "mace":{
                name: "mace", type: 'weapon', 
                desc: 'stun the target if this is the 1st you use this in combat',             
            },
            "dagger pair":{
                name: "dagger pair", type: 'weapon',
                desc: 'hits twice',
            },
            "flail":{
                name: "flail", type: 'weapon',
                desc: "This weapon attacks can't be evaded",
            },
            "axe":{
                name: "axe", type: 'weapon',
                desc: "hits also damage adjacent enemies",
            },
            "hammer":{
                name: "hammer", type: 'weapon',
                desc: "reduce target def by 1 on hit. Can reduce def below 0",
            },
            "halberd":{
                name: "halberd", type: 'weapon',
                desc: "deals 1 extra damage per turn where you haven't dealt damage",
            }, 
            "three blades":{
                name: "three blades", type: 'weapon',
                desc: "hits three times, hits can't deal more than 1 dmg",
            },
            "morgenstern":{
                name: "morgenstern", type: 'weapon',
                desc: "silence the target during this turn on hit",
            },
            "bow":{
                name: "bow", type: 'weapon',
                desc: "avoid melee damage when you attack with this",
            },
            "long bow":{
                name: "long bow", type: 'weapon',
                desc: "roll d6 before the combat, long bow deals damage equal to your roll",
            },
            "elven bow":{
                name: "elven bow", type: 'weapon',
                desc: "avoid attacks when you use this during first two combat turns, your def is set to 1.",
            },
            "x-bow":{
                name: "x-bow", type: 'weapon',
                desc: "attacks with this weapon ignore def, requires 2 actions to attack",
            },
            "torch":{
                name: "torch", type: 'weapon',
                desc: "on hit, set enemy on fire.",
            },
            "wooden staff":{
                name: "wooden staff", type: 'weapon',
                desc: "recover 1 power",
            },
            "iron staff":{
                name: "iron staff", type: 'weapon',
                desc: "recover 2 power, deal no dmg for the next two turns",
            },
            "claymore":{
                name: "claymore", type: 'weapon',
                desc: "deals 10 extra damage, roll dice before attack, reduce damage by the roll value",
            },
            "blood cleaver":{
                name: "blood cleaver", type: 'weapon',
                desc: "on first hit, target looses half of their life",
            },
            "sacrificial knife":{
                name: "sacrificial knife", type: 'weapon',
                desc: "Pay 1 life to attack. Execute target if it's below 25% life",
            },
            "black niddle":{
                name: "black niddle", type: 'weapon',
                desc: "execute targets below 25% life, loose 1 life",
            },
            
        },

        //Offhands
        "offhand":{
            "shield":{
                name: "shield", type: 'offhand',
                desc: 'use it to reduce incomming damage by 50%',
            },
            "wooden shiled":{
                name: "wooden shiled", type: 'offhand',
                desc: 'reduce incoming damage by 3',
            },
            "buckler":{
                name: "buckler", type: 'offhand',
                desc: 'roll dice on use, if roll is less than 11 this item redirects attacks back at the enemy',
            },
            "great shiled":{
                name: "great shiled", type: 'offhand',
                desc: 'reduce incoming dmg by 50%, all enemies target you',
            },

            "War banner":{
                name: "war banner", type: 'offhand',
                desc: 'on first use, allies gain 1 power.',
            },
            "war horn":{
                name: "war banner", type: 'offhand',
                desc: 'On 1st use, allies gain 1 def, all enemies target you',
            },
            "blood talisman":{
                name: "blood talisman", type: 'offhand',
                desc: 'skip turn, for the next two turns gain 2 life when you attack',
            },
            "cursed skull":{
                name: "cursed skull", type: 'offhand',
                desc: 'choose a lesser undead, while you have the skull it becomes your servant',
            },
            "crystal ball":{
                name: "cursed skull", type: 'offhand',
                desc: 'roll dice on use if roll is below 11 gain 1 power, else loose 1 power',
            },
            "mirror shield":{
                name: "mirror shield", type: 'offhand',
                desc: 'On use reflect spell back at caster, roll dice, if 1 mirror shield shatters',
            },
            "magic book":{
                name: `book of ${rarr(magicSchools)}`, type: 'offhand',
                desc: 'pay 5 points of magic trait to unveil a spell'
            }

        },

        //Equipment
        "equipment":{
          
            //Tank fighter
            "Plate armor"   :{desc:"Physical damage you take is capped at 3. -5 magic trait. You can't sneak or hide.", },
            "Royal cape"    :{desc:"Gain 2 life per def.", name: "royal", type: 'equipment'},
            "Plate helmet"  :{desc:"You can't be stunned. -2 magic trait.", },
            "Plate gloves"  :{desc:"-", },
            "Plate boots"   :{desc:"Add 1 def. You can't sneak or hide.", },
            "Plate pants"   :{desc:"-", },
            "Royal belt"    :{desc:"-", },

            "Chainmail"     :{desc:"Add 1 def. -5 magic trait.", },
            "Gambeson"      :{desc:"Add 5 life. -5 magic trait.", },
            "Tabard"        :{desc:"Restore 6 life when you aree kncoked down the first time during the fight.", },
            "Black plate"   :{desc:"At the start of the combat pay 2 max life to gain 3 def.", },

            //Rogue ranger
            "Leather jacket":{desc:"20% chance to dodge an attack. -2 magic trait.", },
            "Leather cape"  :{desc:"+10 to stealth.", },
            "Leather hat"   :{desc:"Poisons deal 2 damage per stack, you deal no physical dmg.", },
            "Leather gloves":{desc:"+5 to theft.", },
            "Leather boots" :{desc:"Adds combat action: Dodge an attack.", },
            "Leather pants" :{desc:"First bow or x-bow attack hits an additional random target.", },
            "Leather belt"  :{desc:"+3 slots for consumables", },

            "Wool jacket"   :{desc:"If equipped: You can pick combat actions for two sequences.", },
            "Dagger belt"   :{desc:"Roll d4, dagger attack ignore that much targets def.", },
            "Potion harness":{desc:"+2 potion slots, uses random potion when character reaches 2 life during combat.", },
            "Face mask"     :{desc:"Roll dice before the combat, if you rolled 1, you have 2 combat actions each turn.", },

            //Mage
            "Silk robe"     :{desc:"Gain 1 power, -2 max life", },
            "Silk cape"     :{desc:"Gain 1 life per power after you canst a spell.", },
            "Silk hat"      :{desc:"Gain 15 magic trait, -3 max life.", },
            "Silk gloves"   :{desc:"You can use one scroll as an extra action during the combat.", },
            "Silk boots"    :{desc:"Restore 2 life after you use a scroll.", },
            "Silk pants"    :{desc:"When you uncover a spell in the spell book, you can choose from two options. -1 def.", },
            "Silk belt"     :{desc:"If equipped:", },

            //Healer
            "Crown"         :{desc:"Gain 5 Holy magic, -2 life", },
            "Purple robe"   :{desc:"Healing spells you cas heal for 1 more.", },
            "Cloth belt"    :{desc:"Gain 1 power after you restored 5 life to other characters.", },

            //Utility
            "Mittens"       :{desc:"Gain 3 cold resistance", },
            "Woolen cloak"  :{desc:"Reduce magic damage by 1.", },
            "Purple robe"   :{desc:"5 to persuasion and charisma", },
            "Thic mittens"  :{desc:"5 crafting", },
        },

        //Consumables
        "consumable":{
            "bandage":{
                name: "bandage", type: 'consumable', rarity: refRarity,
                desc: `consume to restores ${refVal * 2} life`,
            },
            "bottle with water":{
                name: "bottle of water", type: 'consumable', rarity: refRarity,
                desc: `consume to restores 1 power`,
            },
            "ale":{
                name: "ale", type: 'consumable', rarity: refRarity,
                desc: `consume to make your next 3 rolls to be either 1 or 20.`,
            },
            "food":{
                name: "food", type: 'consumable', rarity: refRarity,
                desc: `consume to Restores your stats to default values, can't be used in combat.`,
            },
            "bottle with poison":{
                name: "food", type: 'consumable', rarity: refRarity,
                desc: `contains poison`,
            },
            "smoke bomb":{
                name: "smoke bomb", type: 'consumable', rarity: refRarity,
                desc: `explodes when thrown creating a 3 square meter cloud of smoke`,
            },
            "gas bomb":{
                name: "gas bomb", type: 'consumable', rarity: refRarity,
                desc: `applies 1 poison to all targets in the area.`,
            },
            "small crystal":{
                name: "small crystal", type: 'consumable', rarity: refRarity,
                desc: `consume to add d6 to your next dice roll`,
            },
            "crystal":{
                name: "crystal", type: 'consumable', rarity: refRarity,
                desc: `consume to add d10 to your next dice roll`,
            },
            "large crystal":{
                name: "large crystal", type: 'consumable', rarity: refRarity,
                desc: `consume to add d20 to your next dice roll`,
            },
            "small jewel":{
                name: "small jewel", type: 'consumable', rarity: refRarity,
                desc: `consume to roll d4 instead of default dice for your next dice roll`,
            },
            "jewel":{
                name: "jewel", type: 'consumable', rarity: refRarity,
                desc: `consume to roll d10 instead of default dice for your next dice roll`,
            },
            "large jewel":{
                name: "large jewel", type: 'consumable', rarity: refRarity,
                desc: `consume to roll d20 instead of default dice for your next dice roll`,
            },
            "broken coin":{
                name: "broken coin", type: 'consumable', rarity: refRarity,
                desc: `consume to roll d2 instead of default dice for your next dice roll`,
            },
        },
    
        //Materials & misc
        "materials":{
            "materials":{
                name: `${rarr(materials)}`, type: 'material', rarity: refRarity,
                desc: `x${rng(3)}`,
            },
            "plants":{
                name: `${rarr(plants)}`, type: 'material', rarity: refRarity,
                desc: `x${rng(3)}`,
            },
            "eadalbes":{
                name: `${rarr(eadables)}`, type: 'material', rarity: refRarity,
                desc: `x${rng(3)}`,
            },
            "misc":{
                name: `${rarr(misc)}`, type: 'material', rarity: refRarity,
                desc: `enables certain actions`,
            },
        },

        //Utility
        "utility":{
            "bag":{
                name: "small bag", type: 'equipment',
                desc: `provides ${rng(8, 3)} item slots (items in the bag don't provide passive effects)`,
            },
        },
    }

    //String creator
    function loot(itemQuant){
        let allItemList = []
        let lootList = ''
        let objKeys = Object.keys(itemsJson) //array
        if(itemQuant === undefined){itemQuant = 20} //total quant of items

        //Build all items
        for(i=0;i<objKeys.length;i++){//check all groups
            let itemKeys = Object.keys(itemsJson[objKeys[i]])//All item keys
            for(ite=0; ite<itemKeys.length;ite++){//per every item
                let itemObj = itemsJson[[objKeys[i]]][itemKeys[ite]]//choose item

                let itemName = itemKeys[ite].charAt(0).toUpperCase() + itemKeys[ite].slice(1) //Capitalizes

                if(itemObj.type === 'material'){ //If material use name parameter
                    itemName = itemObj.name.charAt(0).toUpperCase() + itemObj.name.slice(1) //Capitalizes
                }

                allItemList.push(`${itemName} - ${itemObj.desc}.<br>`) //Build item label
            }
        }

        //Shuffle array
        shuffle(allItemList)

        //List first N items
        for(q=0;q<itemQuant;q++){
            if(q % 5 === 0){lootList += '<br>'} //Break after every 5 items
            lootList += allItemList[q]
        }

        //Post
        document.getElementById('items').innerHTML = lootList
    }

    //Post items
    loot()



    //Enemy calculator
    let lvl = 2
    let dmgVal = Math.ceil(rng(refVal) * lvl)
    let enemyActions

    function genEnemyActions(level){
        if(level ===undefined){level = document.getElementById('eneLvl').value} //Picks val from input
        let actionRoll = rng(100)
        let enemyAc
        console.log(actionRoll);
        dmgVal = Math.ceil(rng(refVal/1.5) * level)

        enemyActions = {
            "attack":   {rate:0,   desc: `Will attack for ${dmgVal}`},
            "str att":  {rate:3,   desc: `Will crit for ${dmgVal * 2}`},
            "poi att":  {rate:3,   desc: `Will attack with poison for ${dmgVal}`},
            "fire att": {rate:3,   desc: `Will attack with fire for ${dmgVal}`},
            "mutli att":{rate:2,   desc: `Will attack ${rng(3,2)} times, each hit deals ${Math.ceil(dmgVal * 0.5)}`},
            "crit":     {rate:1,   desc: `Will crit for ${Math.ceil(dmgVal * 2.5)} after this turn`},
            
            "spell":    {rate:1,   desc: `Will cast a <random spell>`},
                
            "recover":  {rate:3,   desc: `Will recover lost stats`},
            "def break":{rate:3,   desc: `Will reduce your def by ${dmgVal}`},
            "buff":     {rate:2,   desc: `Will use <random buff spell>`},
            "debuff":   {rate:2,   desc: `Will use <random debuff spell>`},

            "wrestle":  {rate:2,   desc: `Roll dice (GM rlls for enemy), who rolls less looses 4 life.`},
            "recruits": {rate:2,   desc: `Will call reinforcements`},
            "disarm":   {rate:1,   desc: `Will steal item used against it during the next turn`},
            "theft":    {rate:1,   desc: `Will steal random item`},   

            "command":  {rate:1,   desc: `Will actions of all enemies on you`},
            "consume":  {rate:1,   desc: `Enemy will consume a random consumable from targets inveentory`},
            "reflect":  {rate:1,   desc: `Will reflect all spells to character that targets this`},

            "escape":   {rate:1,   desc: `Will escape`},
            "sepuku":   {rate:1,   desc: `Will deal ${Math.ceil(dmgVal * 2.5)} to character that would kill them`}
        }

        let aAction = []                           //Array of descriptions for 1%
        let actionKeys = Object.keys(enemyActions) //Get keys

        //Pick action
        if(actionRoll < 10){//1%
            for(i=0; i<actionKeys.length; i++){
                if(enemyActions[actionKeys[i]].rate === 1){
                    aAction.push(enemyActions[actionKeys[i]].desc)
                }
            }
            return rarr(aAction)
        } 
        else if (actionRoll < 30){//10%
            for(i=0; i<actionKeys.length; i++){
                if(enemyActions[actionKeys[i]].rate === 2){
                    aAction.push(enemyActions[actionKeys[i]].desc)
                }
            }
            enemyAc = rarr(aAction)
        } 
        else if (actionRoll < 65){//30%
            for(i=0; i<actionKeys.length; i++){
                if(enemyActions[actionKeys[i]].rate === 3){
                    aAction.push(enemyActions[actionKeys[i]].desc)
                }
            }
            enemyAc = rarr(aAction)
        } 
        else {
            enemyAc = enemyActions.attack.desc
        }

        document.getElementById('enemy').innerHTML = `Enemy (0 life) &rarr; ${enemyAc}.`
    }
</script>

<style>
    button, input{
        width: 200px;
        min-height: 32px;
    }

    p{
        font-family: sans-serif;
        line-height: 140%;
    }
    body{
        gap: 8px;
        padding: 48px;
        margin: 0;
        display: flex;
    }

    body div{
        width: 100%;
        gap: 8px;
    }
</style>
</html>